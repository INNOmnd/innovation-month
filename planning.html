<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Casade Planning — INNOvember</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand:#86BC25; --brand-dark:#5D7A15; }
    .cell { position: relative; }
    .event {
      position:absolute; left:2px; right:2px;
      border-radius:10px; padding:6px 8px; font-size:12px; line-height:1.2;
      background:#E6F3D0; border:1px solid #CDE5A5; cursor:pointer; z-index:5;
      box-shadow: 0 1px 0 rgba(0,0,0,.04);
    }
    .event:hover { outline:2px solid var(--brand); }
  </style>
</head>
<body class="bg-slate-50">
  <header class="sticky top-0 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-4">
      <img src="casade-logo.png" class="h-10" alt="Casade" />
      <h1 class="text-xl font-bold" style="color:var(--brand)">November Planning</h1>
      <nav class="ml-auto text-sm flex gap-6">
        <a href="index.html" class="hover:underline">Home</a>
        <a href="blog.html" class="hover:underline">Blog</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Week navigation -->
    <div class="flex items-center justify-between mb-4">
      <button id="prevWeek" class="px-3 py-2 rounded-xl border border-slate-300 bg-white">Vorige</button>
      <h2 id="weekTitle" class="text-lg font-semibold"></h2>
      <button id="nextWeek" class="px-3 py-2 rounded-xl border border-slate-300 bg-white">Volgende</button>
    </div>

    <!-- Timetable -->
    <div class="overflow-x-auto border border-slate-200 rounded-2xl bg-white">
      <table class="w-full text-sm">
        <thead class="bg-slate-100">
          <tr>
            <th class="w-24 p-3 text-left">Time</th>
            <th class="p-3 text-left">Mon</th>
            <th class="p-3 text-left">Tue</th>
            <th class="p-3 text-left">Wed</th>
            <th class="p-3 text-left">Thu</th>
            <th class="p-3 text-left">Fri</th>
          </tr>
        </thead>
        <tbody id="grid"></tbody>
      </table>
    </div>
    <p class="text-xs text-slate-500 mt-2">Click a session for details.</p>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 hidden items-center justify-center bg-black/50">
      <div class="bg-white max-w-xl w-[92vw] rounded-2xl p-6">
        <div class="flex items-start gap-4">
          <img id="mBanner" class="w-24 h-24 object-cover rounded-xl border border-slate-200" alt="" />
          <div>
            <h3 id="mTitle" class="text-xl font-bold"></h3>
            <p id="mMeta" class="text-sm text-slate-600"></p>
          </div>
          <button id="closeModal" class="ml-auto text-slate-600">✕</button>
        </div>
        <p id="mDesc" class="mt-4 text-slate-700"></p>
      </div>
    </div>
  </main>

  <script>
    // Use November of this year (if Nov already passed, use next year)
    const today=new Date();
    const currentYear = (today.getMonth() <= 10) ? today.getFullYear() : today.getFullYear()+1; // 0-based months; 10 = Nov
    const NOVEMBER=10;

    // EDIT: your real workshops + banners in /assets/workshops/
    const WORKSHOPS=[
      { id:'taal-tool', title:'Taaltool Sessie 1', date:`${currentYear}-11-05`, start:'09:30', end:'11:30', speaker:'Joan', banner:'pictures/taaltool.png', desc:'Verkenning van de taaltool' },
      { id:'aftrap', title:'De Aftrap', date:`${currentYear}-11-11`, start:'09:00', end:'11:00', speaker:'Ergin', banner:'pictures/aftrap.png', desc:'We nemen jullie mee in het hele plaatje van innovatie.' },
      { id:'wrk-ai-beginner', title:'Werken met AI beginner', date:`${currentYear}-11-11`, start:'13:00', end:'15:00', speaker:'Job', banner:'pictures/werkenmetai.png', desc:'Een AI cursus voor beginners' },
      { id:'goeie-buurtaal-ai', title:'Goeie Buur-taal met AI', date:`${currentYear}-11-13`, start:'09:00', end:'11:00', speaker:'Amy en Wendy', banner:'pictures/buurtaal.png', desc:'Gebruik AI om jouw goeie buurtaal te verbeteren.' },
      { id:'dwam', title:'Drone With A Mission', date:`${currentYear}-11-13`, start:'11:00', end:'13:00', speaker:'Ruud Janssen', banner:'pictures/dwam.png', desc:'Zie hoe drones in ons werkveld zorgen voor innovatie.' },
      { id:'taal-tool2', title:'Taaltool Sessie 2', date:`${currentYear}-11-13`, start:'10:00', end:'12:00', speaker:'Joan', banner:'pictures/taaltool.png', desc:'Verkenning van de taaltool.' },
      { id:'wrk-ai-intermediate', title:'Werken met AI Gevorderd', date:`${currentYear}-11-13`, start:'13:00', end:'15:00', speaker:'Job', banner:'werkenmetai.png', desc:'Werken met AI voor gevorderden.' },
      { id:'shortcut', title:'The Shortcut', date:`${currentYear}-11-17`, start:'09:00', end:'11:00', speaker:'Sanne Cornelissen', banner:'pictures/sanna.jpg', desc:'Leer AI toe te passen in jouw werk.' },
      { id:'agile-scrum', title:'Agile Scrum', date:`${currentYear}-11-18`, start:'13:00', end:'15:00', speaker:'Rogier', banner:'pictures/aftrap.png', desc:'Agile scrum.' },
      { id:'omaia', title:'OMAIA Sessie 1', date:`${currentYear}-11-20`, start:'09:00', end:'11:00', speaker:'Rogier', banner:'pictures/omaia.png', desc:'OMAIA.' },
      { id:'thuisapp', title:'Thuisapp Sessie 1', date:`${currentYear}-11-20`, start:'10:00', end:'12:00', speaker:'Tessa', banner:'pictures/thuisapp.png', desc:'Thuisapp.' },
      { id:'omaia2', title:'OMAIA Sessie 2', date:`${currentYear}-11-20`, start:'13:00', end:'15:00', speaker:'Tessa', banner:'pictures/omaia.png', desc:'OMAIA.' },
      { id:'thuisapp2', title:'Thuisapp Sessie 2', date:`${currentYear}-11-20`, start:'15:00', end:'17:00', speaker:'Tessa', banner:'pictures/thuisapp.png', desc:'Thuisapp.' },
      { id:'goeie-buurtaal', title:'Goeie Buurtaal', date:`${currentYear}-11-25`, start:'11:00', end:'13:00', speaker:'Amy en Wendy', banner:'pictures/buurtaal.png', desc:'Goeie buurtaal zonder AI.' },
      { id:'taal-tool3', title:'Taaltool Sessie 3', date:`${currentYear}-11-27`, start:'12:30', end:'14:00', speaker:'Joan', banner:'pictures/taaltool.png', desc:'Taaltool.' }
    ];

    // Build weeks of November (Mon–Fri)
    function getWeeks(year){
      const first=new Date(year, NOVEMBER, 1);
      const last=new Date(year, NOVEMBER+1, 0);
      const start=new Date(first);
      const day=(start.getDay()+6)%7; // Mon=0
      start.setDate(start.getDate()-day);
      const weeks=[];
      let cur=new Date(start);
      while(cur<=last){
        const days=[];
        for(let i=0;i<5;i++){ const d=new Date(cur); d.setDate(cur.getDate()+i); days.push(new Date(d)); }
        weeks.push(days);
        cur.setDate(cur.getDate()+7);
      }
      return weeks;
    }

    const weeks=getWeeks(currentYear);
    let weekIdx=0;

    const grid=document.getElementById('grid');
    const weekTitle=document.getElementById('weekTitle');

    function timeToIdx(t){ const [h,m]=t.split(':').map(Number); return (h-9)*2 + (m>=30?1:0); } // 09:00 baseline

    function renderWeek(){
      const days=weeks[weekIdx];
      const opts={ day:'2-digit', month:'short' };
      weekTitle.textContent=`Week ${weekIdx+1} • ${days[0].toLocaleDateString(undefined,opts)} – ${days[4].toLocaleDateString(undefined,opts)} ${currentYear}`;

      // times 09:00..17:00 per 30 min slots
      const times=[]; for(let h=9; h<=17; h++){ times.push(`${String(h).padStart(2,'0')}:00`); if(h<17) times.push(`${String(h).padStart(2,'0')}:30`); }
      grid.innerHTML='';
      times.forEach(t=>{
        const tr=document.createElement('tr');
        const th=document.createElement('th'); th.className='align-top p-2 w-24 text-left text-slate-600'; th.textContent=t; tr.appendChild(th);
        for(let c=0;c<5;c++){ const td=document.createElement('td'); td.className='relative h-14 align-top border-t border-slate-100 cell'; tr.appendChild(td); }
        grid.appendChild(tr);
      });

      const rows=grid.querySelectorAll('tr');
      const slotHeight=rows[0].children[1].getBoundingClientRect().height || 56;

      // Collect events per weekday for this week (Mon..Fri)
      const startOfWeek=days[0]; const endOfWeek=days[4];
      const weekEvents=WORKSHOPS.filter(w=>{ const d=new Date(w.date); return d>=new Date(startOfWeek.toDateString()) && d<=new Date(endOfWeek.toDateString()); });

      // Group by weekday (0..4 => Mon..Fri)
      const byDay=[[],[],[],[],[]];
      weekEvents.forEach(ev=>{
        const d=new Date(ev.date); const col=( (d.getDay()+6)%7 );
        if(col<=4) byDay[col].push(ev);
      });

      // For each day, assign lanes to avoid overlaps and render
      byDay.forEach((events, col)=>{
        // Sort by start time
        events.sort((a,b)=> timeToIdx(a.start) - timeToIdx(b.start) || timeToIdx(a.end) - timeToIdx(b.end));

        // Sweep-line to assign lanes (interval graph coloring)
        const active=[]; // [{endIdx, lane}]
        events.forEach(ev=>{
          const s=timeToIdx(ev.start);
          const e=timeToIdx(ev.end);
          // free lanes whose end <= s
          for(let i=active.length-1;i>=0;i--){ if(active[i].end<=s) active.splice(i,1); }
          // find smallest available lane
          const used=new Set(active.map(a=>a.lane));
          let lane=0; while(used.has(lane)) lane++;
          ev._lane=lane;
          ev._startIdx=s; ev._endIdx=e;
          active.push({end:e, lane});
          // also track max lanes overlapping this interval (for width calc later)
        });

        // Determine overlapping cluster widths:
        // For every event, compute how many are active with it
        events.forEach(ev=>{
          const s=ev._startIdx, e=ev._endIdx;
          ev._lanes = Math.max(...events.map(o=>{
            const os=o._startIdx, oe=o._endIdx;
            const overlap = Math.max(0, Math.min(e,oe) - Math.max(s,os)) > 0;
            return overlap ? Math.max(ev._lane, o._lane)+1 : 1;
          }));
        });

        // Render events into the *start row* cell of the day
        events.forEach(ev=>{
          const startCell = rows[ev._startIdx].children[col+1];
          const div=document.createElement('div');
          div.className='event';
          // vertical position/height
          const durationRows=Math.max(1, ev._endIdx - ev._startIdx);
          div.style.top = '2px';
          div.style.height = `calc(${durationRows*slotHeight}px - 4px)`;
          // horizontal lane layout
          const lanes = Math.max(ev._lanes, ...events.filter(o=>{
            // consider other events that overlap with this one
            return Math.max(0, Math.min(ev._endIdx,o._endIdx) - Math.max(ev._startIdx,o._startIdx)) > 0;
          }).map(o=>o._lane+1), ev._lane+1);
          const gap = 4; // px total gap between columns
          const widthPct = (100 / lanes);
          div.style.width = `calc(${widthPct}% - ${gap}px)`;
          div.style.left  = `calc(${ev._lane * widthPct}% + 2px)`;
          // content
          div.innerHTML=`<strong>${ev.title}</strong><br><span>${ev.start}–${ev.end}</span><br><em>${ev.speaker}</em>`;
          div.addEventListener('click',()=>openModal(ev));
          startCell.appendChild(div);
        });
      });
    }

    function openModal(ev){
      document.getElementById('mBanner').src=ev.banner;
      document.getElementById('mTitle').textContent=ev.title;
      document.getElementById('mMeta').textContent=`${new Date(ev.date).toLocaleDateString()} • ${ev.start}–${ev.end} • ${ev.speaker}`;
      document.getElementById('mDesc').textContent=ev.desc;
      const modal=document.getElementById('modal');
      modal.classList.remove('hidden'); modal.classList.add('flex');
    }

    document.getElementById('closeModal').addEventListener('click',()=>document.getElementById('modal').classList.add('hidden'));
    document.getElementById('prevWeek').addEventListener('click',()=>{ weekIdx=Math.max(0,weekIdx-1); renderWeek(); });
    document.getElementById('nextWeek').addEventListener('click',()=>{ weekIdx=Math.min(weeks.length-1,weekIdx+1); renderWeek(); });

    renderWeek();
  </script>
</body>
</html>
